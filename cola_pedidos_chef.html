<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cola de Pedidos - María Chula</title>
    <link rel="stylesheet" href="cola_pedidos_chef.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="fotos/iconomch.ico" type="image/x-icon">
</head>
<body>
    <div class="app">
        <aside class="sidebar card">
            <div class="logo">
                <img src="fotos/logomch.png" alt="Logo María Chula">
                <h2>María Chula</h2>
            </div>
            <div class="menu-list">
                <a href="menu.html" class="menu-item">Menú</a>
                <a href="inventory.html" class="menu-item">Inventario</a>
                <a href="index.html" class="menu-item">Inicio</a>
                <a href="admin-menus.html" class="menu-item">Administración de Menús</a>
                <a href="admin-users.html" class="menu-item">Administración de usuarios</a>
                <a href="billing.html" class="menu-item">Facturación</a>
                <a href="events.html" class="menu-item">Eventos</a>
                <a href="history-events.html" class="menu-item">Historial de Eventos</a>
                <a href="history-orders.html" class="menu-item">Historial de Pedidos</a>
                <a href="queue.html" class="menu-item active">Cola de pedidos</a>
            </div>
        </aside>

        <main class="main">
            <div class="header">
                <div class="title">Cola de Pedidos - Vista Cocinero</div>
                <a href="panel.html" class="back-button">
                    <i class="fas fa-arrow-left"></i> Regresar
                </a>
            </div>

            <div class="card">
                <h2>Lista de Pedidos en Cola</h2>
                <table class="table" id="ordersTable">
                    <thead>
                        <tr>
                            <th>ID Pedido</th>
                            <th>Cliente</th>
                            <th>Platillos</th>
                            <th>Estado</th>
                            <th>Hora</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Los pedidos se insertarán aquí -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Modal para ver detalles del pedido -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Detalles del Pedido</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <!-- Los detalles del pedido se insertarán aquí -->
            </div>
        </div>
    </div>

    <script>
        // Datos de ejemplo (en una aplicación real, estos vendrían de una API o base de datos)
        const orders = [
            {
                id: 1,
                client: "Juan Pérez",
                items: [
                    { name: "Tacos al Pastor", quantity: 2, price: 25.00 },
                    { name: "Enchiladas", quantity: 1, price: 35.00 },
                    { name: "Limonada", quantity: 2, price: 18.00 }
                ],
                status: "preparation",
                timestamp: "2023-05-15 14:30",
                notes: "Sin cebolla en los tacos"
            },
            {
                id: 2,
                client: "María García",
                items: [
                    { name: "Mole Poblano", quantity: 1, price: 45.00 },
                    { name: "Guacamole", quantity: 1, price: 20.00 },
                    { name: "Vino de la Casa", quantity: 1, price: 25.00 }
                ],
                status: "pending",
                timestamp: "2023-05-15 14:45",
                notes: ""
            },
            {
                id: 3,
                client: "Carlos López",
                items: [
                    { name: "Chiles Rellenos", quantity: 2, price: 40.00 },
                    { name: "Quesadillas", quantity: 1, price: 30.00 },
                    { name: "Agua de Horchata", quantity: 2, price: 15.00 }
                ],
                status: "ready",
                timestamp: "2023-05-15 14:20",
                notes: "Extra picante en los chiles"
            }
        ];

        // Cargar pedidos al iniciar
        document.addEventListener('DOMContentLoaded', () => {
            renderOrders();
        });

        // Renderizar pedidos en la tabla
        function renderOrders() {
            const tableBody = document.querySelector('#ordersTable tbody');
            tableBody.innerHTML = '';
            
            if (orders.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 20px; color: var(--color-muted);">
                            <i class="fas fa-clipboard-list" style="font-size: 24px; margin-bottom: 10px;"></i>
                            <p>No hay pedidos en cola</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Ordenar pedidos por estado (pendientes primero)
            const sortedOrders = [...orders].sort((a, b) => {
                const statusOrder = { pending: 0, preparation: 1, ready: 2, delivered: 3 };
                return statusOrder[a.status] - statusOrder[b.status];
            });
            
            sortedOrders.forEach(order => {
                const row = document.createElement('tr');
                
                // Obtener nombres de platillos
                const itemsList = order.items.map(item => `${item.quantity}x ${item.name}`).join(', ');
                
                // Obtener texto y clase para el estado
                let statusText, statusClass;
                switch(order.status) {
                    case 'pending':
                        statusText = 'Pendiente';
                        statusClass = 'status-pending';
                        break;
                    case 'preparation':
                        statusText = 'En preparación';
                        statusClass = 'status-preparation';
                        break;
                    case 'ready':
                        statusText = 'Listo';
                        statusClass = 'status-ready';
                        break;
                    case 'delivered':
                        statusText = 'Entregado';
                        statusClass = 'status-delivered';
                        break;
                    default:
                        statusText = 'Pendiente';
                        statusClass = 'status-pending';
                }
                
                row.innerHTML = `
                    <td>#${order.id}</td>
                    <td>${order.client}</td>
                    <td>${itemsList}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>${formatTime(order.timestamp)}</td>
                    <td>
                        <button class="btn primary" onclick="viewOrder(${order.id})">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                        <button class="btn warning" onclick="updateOrderStatus(${order.id})">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Ver detalles del pedido
        function viewOrder(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            const modal = document.getElementById('orderModal');
            const modalBody = document.getElementById('modalBody');
            
            // Obtener texto para el estado
            let statusText;
            switch(order.status) {
                case 'pending':
                    statusText = 'Pendiente';
                    break;
                case 'preparation':
                    statusText = 'En preparación';
                    break;
                case 'ready':
                    statusText = 'Listo';
                    break;
                case 'delivered':
                    statusText = 'Entregado';
                    break;
                default:
                    statusText = 'Pendiente';
            }
            
            // Calcular total
            const total = order.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Construir HTML para los items
            let itemsHTML = '';
            order.items.forEach(item => {
                itemsHTML += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #f0f0f0;">
                        <div>${item.quantity}x ${item.name}</div>
                        <div>Q${(item.price * item.quantity).toFixed(2)}</div>
                    </div>
                `;
            });
            
            modalBody.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div><strong>Cliente:</strong> ${order.client}</div>
                        <div><strong>Estado:</strong> ${statusText}</div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Hora del pedido:</strong> ${formatDateTime(order.timestamp)}
                    </div>
                    ${order.notes ? `<div style="margin-bottom: 15px;"><strong>Notas:</strong> ${order.notes}</div>` : ''}
                </div>
                
                <h4 style="margin-bottom: 15px; color: var(--color-primary);">Items del Pedido</h4>
                ${itemsHTML}
                
                <div style="display: flex; justify-content: space-between; margin-top: 20px; padding-top: 10px; border-top: 2px solid var(--color-primary); font-weight: bold;">
                    <div>Total:</div>
                    <div>Q${total.toFixed(2)}</div>
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn success" onclick="markAsReady(${order.id})">
                        <i class="fas fa-check-circle"></i> Marcar como Listo
                    </button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        // Actualizar estado del pedido
        function updateOrderStatus(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            // Determinar el próximo estado
            let newStatus;
            switch(order.status) {
                case 'pending':
                    newStatus = 'preparation';
                    break;
                case 'preparation':
                    newStatus = 'ready';
                    break;
                case 'ready':
                    newStatus = 'delivered';
                    break;
                default:
                    newStatus = 'pending';
            }
            
            // Actualizar estado
            order.status = newStatus;
            
            // Mostrar mensaje
            let statusText;
            switch(newStatus) {
                case 'preparation':
                    statusText = 'En preparación';
                    break;
                case 'ready':
                    statusText = 'Listo';
                    break;
                case 'delivered':
                    statusText = 'Entregado';
                    break;
                default:
                    statusText = 'Pendiente';
            }
            
            alert(`El estado del pedido #${id} ha sido actualizado a: ${statusText}`);
            
            // Volver a renderizar la tabla
            renderOrders();
        }

        // Marcar pedido como listo
        function markAsReady(id) {
            const order = orders.find(o => o.id === id);
            if (!order) return;
            
            order.status = 'ready';
            alert(`El pedido #${id} ha sido marcado como Listo`);
            
            // Cerrar modal y actualizar tabla
            closeModal();
            renderOrders();
        }

        // Formatear fecha y hora
        function formatDateTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('es-ES');
        }

        // Formatear solo la hora
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
        }

        // Cerrar modal si se hace clic fuera del contenido
        window.onclick = function(event) {
            const modal = document.getElementById('orderModal');
            if (event.target === modal) {
                closeModal();
            }
        };
    </script>
</body>
</html>